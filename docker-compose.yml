version: "2"

services:
    app:
        build: ./
        volumes:
            - ./:/usr/src/app
        ports:
            - "8443:8443"
        links:
            - mongodb
        environment:
            - API_KEY
            - API_SECRET
            - WS_PORT
            - HTTP_PORT
            - MONGODB_USER
            - MONGODB_PASS
            - MONGODB_HOST
            - MONGODB_PORT
            - MONGODB_NAME
            - SSL_KEY=/usr/src/app/certs/key.pem
            - SSL_CERT=/usr/src/app/certs/cert.pem
            - SSL_CA=/usr/src/app/certs/ca-bundle
    data:
        image: 'ubuntu'
        volumes:
            - /var/lib/mysql:/var/lib/mysql
            - /var/lib/postgres:/var/lib/postgres
            - /var/lib/mariadb:/var/lib/mariadb
            - /var/lib/memcached:/var/lib/memcached
            - /var/lib/redis:/data
            - /var/lib/neo4j:/var/lib/neo4j/data
            - /var/lib/mongo:/data/db
        command: ["true"]

    mongodb:
        image: mongo
        expose:
            - "3306"
        volumes_from:
            - dat
        ports:
            - "27017:27017"
        environment:
            - MONGODB_USER
            - MONGODB_PASS
            - MONGODB_NAME
        command: --auth
